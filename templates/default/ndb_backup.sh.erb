#!/bin/bash

help() {
    echo "usage: $0 backup|[restore id] "
    echo ""
    exit 1
}

if [ $# -ne 2  ]; then
    help
fi

# Check that $2 is an int (and not some injection attack)
re='^[0-9]+$'
if ! [[ $2 =~ $re ]] ; then
    echo "error: Not a number" >&2
    help
fi

if [ "$1" = "backup" ] ; then
    su <%= node.ndb.user %> -c "<%= node.ndb.scripts_dir %>/backup-start.sh"
elif [ "$1" = "restore" ] ; then
    su <%= node.ndb.user %> -c "<%= node.ndb.scripts_dir %>/backup-restore.sh $2"
else
    help
fi

exit $?
